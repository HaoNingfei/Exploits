package MEDIAWIKI::MSF::MediawikiThumb;
use lib qw(../../); use parent qw(Exploit);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use File::Slurp qw(read_file);

# # 
# # 
# # 

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   

   my $name = "MediawikiThumb";

   my $DETECTION = {

   };

my $EXPLOIT = {
  CVE => "CVE-2014-1610",
  DESCRIPTION => "

        MediaWiki 1.22.x before 1.22.2, 1.21.x before 1.21.5 and 1.19.x before 1.19.11,

      when DjVu or PDF file upload support is enabled, allows remote unauthenticated

      users to execute arbitrary commands via shell metacharacters. If no target file

      is specified this module will attempt to log in with the provided credentials to

      upload a file (.DjVu) to use for exploitation.

      ",
  MSF_MODULE => "mediawiki_thumb",
  OSVDB => 102630,
  REFERENCES => [
    "http://www.checkpoint.com/threatcloud-central/articles/2014-01-28-tc-researchers-discover.html",
    "https://bugzilla.wikimedia.org/show_bug.cgi?id=60339",
  ],
  TITLE => "MediaWiki Thumb.php Remote Command Execution",


  TYPE => 'MSF',
  PLATFORM => 'MULTI',
  REQUESTS => {
    EXPLOIT1 => {
      METHOD       => 'GET',
      PATH   => '',
      PAYLOAD      => '',
      TEXT   => 'Sending Exploit #1 Request : [GET] ',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($name, $DETECTION, $EXPLOIT, @_);
}

return 1;
