package MSFExploits::Exploits::APACHE::MSF::ApacheRollerOgnlInjection;
# use parent qw(MSFExploits::Exploit MSFExploits::Services::APACHE);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use Coro qw( async );

# # use MSFExploits::Functions::Basic;
# # use MSFExploits::Functions::Errors;
# # use MSFExploits::Functions::Content;

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   my ( $requester, $database ) = @_;

   my $name = "ApacheRollerOgnlInjection";

   my $DETECTION = {

   };

my $EXPLOIT = {
  CVE => "CVE-2013-4212",
  DESCRIPTION => "

        This module exploits an OGNL injection vulnerability in Apache Roller < 5.0.2. The

        vulnerability is due to an OGNL injection on the UIAction controller because of an

        insecure usage of the ActionSupport.getText method. This module has been tested

        successfully on Apache Roller 5.0.1 on Ubuntu 10.04.

      ",
  METHOD => "GET",
  MSF_MODULE => "apache_roller_ognl_injection",
  PATH => "pageTitle=__PAGETITLE__&",
  REFERENCES => [
    "http://security.coverity.com/advisory/2013/Oct/remote-code-execution-in-apache-roller-via-ognl-injection.html",
  ],
  TITLE => "Apache Roller OGNL Injection",
  VARIABLES => {
    'ADDEND_ONE' =>       { DESCRIPTION => "", VALUE => "" },
    'PAGETITLE' =>       { DESCRIPTION => "", VALUE => "" },
  },

  TYPE => 'MSF',
  PLATFORM => 'MULTI',
  REQUESTS => {
    EXPLOIT1 => {
      METHOD       => 'GET',
      PATH   => '',
      PAYLOAD      => '',
      TEXT   => 'Sending Exploit #1 Request : [GET] ',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($requester, $database, $name, $DETECTION, $EXPLOIT, @_);
}

return 1;
